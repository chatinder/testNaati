<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Naati With Singh CCL Punjabi Dialogues</title>
    <style>
        /* Your existing CSS styles */
    </style>
</head>
<body>
    <div class="container" id="contentContainer" style="display: none;">
        <h1>Naati With Singh CCL Punjabi Dialogues</h1>
        <p class="notice">This audio is for listening only. Downloading and sharing are restricted.</p>
        
        <div class="lesson">
            <h2>Finance</h2>
            <div class="audio-buttons">
                <button onclick="loadAndPlayAudio('finance/P25_financial.mp3')">Finance - Audio 1</button>
                <button onclick="loadAndPlayAudio('finance/P38_financial.mp3')">Finance - Audio 2</button>
            </div>
        </div>

        <div class="custom-audio-controls">
            <button id="playPauseButton">Play</button>
            <button id="logoutButton" onclick="logout()">Logout</button>
        </div>
    </div>

    <div class="container" id="loginContainer">
        <h2>Please Sign In</h2>
        <button id="googleSignInButton">Sign in with Google</button>
    </div>

    <script type="module">
        document.addEventListener("DOMContentLoaded", function() {
            // Import Firebase modules
            import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
            import { getAuth, GoogleAuthProvider, signInWithPopup, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";

            const firebaseConfig = {
                apiKey: "YOUR_API_KEY",
                authDomain: "YOUR_AUTH_DOMAIN",
                projectId: "YOUR_PROJECT_ID",
                storageBucket: "YOUR_STORAGE_BUCKET",
                messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
                appId: "YOUR_APP_ID",
                measurementId: "YOUR_MEASUREMENT_ID"
            };

            const app = initializeApp(firebaseConfig);
            const auth = getAuth(app);
            const provider = new GoogleAuthProvider();
            const allowedEmail = "naatiwithsingh@gmail.com";

            const loginContainer = document.getElementById("loginContainer");
            const contentContainer = document.getElementById("contentContainer");
            const googleSignInButton = document.getElementById("googleSignInButton");
            const playPauseButton = document.getElementById('playPauseButton');

            let audioPlayer = null;

            async function googleSignIn() {
                try {
                    const result = await signInWithPopup(auth, provider);
                    const user = result.user;
                    if (user.email === allowedEmail) {
                        contentContainer.style.display = "block";
                        loginContainer.style.display = "none";
                    } else {
                        alert("Access Denied: Unauthorized Email");
                        await signOut(auth);
                    }
                } catch (error) {
                    console.error("Authentication error:", error);
                    alert(`Authentication failed: ${error.message}.`);
                }
            }

            async function logout() {
                try {
                    await signOut(auth);
                    contentContainer.style.display = "none";
                    loginContainer.style.display = "block";
                } catch (error) {
                    console.error("Error during sign-out:", error);
                    alert("Logout failed. Please try again.");
                }
            }

            googleSignInButton.addEventListener("click", googleSignIn);

            onAuthStateChanged(auth, (user) => {
                if (user && user.email === allowedEmail) {
                    contentContainer.style.display = "block";
                    loginContainer.style.display = "none";
                } else {
                    contentContainer.style.display = "none";
                    loginContainer.style.display = "block";
                }
            });

            function loadAndPlayAudio(filePath) {
                if (audioPlayer) audioPlayer.pause();
                audioPlayer = new Audio(filePath);
                audioPlayer.play();
                playPauseButton.textContent = 'Pause';

                audioPlayer.onended = () => playPauseButton.textContent = 'Play';
            }

            playPauseButton.addEventListener('click', () => {
                if (audioPlayer) {
                    if (audioPlayer.paused) {
                        audioPlayer.play();
                        playPauseButton.textContent = 'Pause';
                    } else {
                        audioPlayer.pause();
                        playPauseButton.textContent = 'Play';
                    }
                } else {
                    alert("Please select an audio file first.");
                }
            });

            document.addEventListener('contextmenu', event => event.preventDefault());
            document.addEventListener('keydown', function(event) {
                if (event.ctrlKey && (event.key === 's' || event.key === 'p')) {
                    event.preventDefault();
                    alert("Downloading is disabled on this page.");
                }
            });
        });
    </script>
</body>
</html>
